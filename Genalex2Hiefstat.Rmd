Genalex to hierfstat
========================================================

This should be an easy one to work up.  The idea will be to read the file we generated from the genalex input, determine how many factor columns there are, paste the remainder and go for it.

```{r}
source("readGenalex.R")
```
```{r}
dat <- read.genalex ("IGSGenalex.csv")
```
For convenience sake, pull out the genotypes
```{r}
dat.gen <-dat$genotypes
```
Now we need to figure out how many factors there are:
```{r}
dat.sum <-summary(dat.gen)
```

Sidelight - need to see if we can read single population with revised output:

```{r}
test <-read.genalex("Sample5pop.csv")
```
OK.  That leads to a solution - ifelse based on nregion==NULL
```{r}
fac.col <-ifelse(is.null(dat$nregion),1,2)
fac.col
```
OK.  Can't get it to return a vector, but we can use the numbers
```{r}
pop.levels <-dat$genotypes[,1:fac.col]
head(pop.levels)
```
OK.  That works.  Now for the genotypes - remove the columns and paste them together

```{r}
pop.loci <-dat.gen[,-c(1:fac.col)]
pop.loci[1:10,1:10]
```
And a quick test to be sure it works for test
```{r}
fac.col=1
test.loci <-test$genotypes[-c(1:fac.col)]
test.loci[1:10,1:10]
```
So from here on out we will just work with the igs data.  Once we get it functionized we can then test it with other scenarios.  All that is left then is to put in the code to paste the columns.  Code edited from Fst.Rmd:
```{r}
n <-ncol(pop.loci)-1
dat.loci <-sapply(seq(1,n,2), function(x) (paste(pop.loci[,x],pop.loci[,x+1],sep="")))
str(dat.loci)
```

So the problem now is to do an appropriate conversion to numeric.

```{r}
dat.loci <-data.frame(apply(dat.loci,2, as.numeric))
dim(dat.loci)
str(dat.loci)
```
Now we should be in good shape; we'll probably want to call the hierfstat functions from either the main program or a wrapper.  But as a quick test we will do it now:

```{r}
library(hierfstat)
```
And a call

```{r}
varcomp.glob(pop.levels,dat.loci)
```
### Testing the two functions

With the two functions loaded (as.hierfstat, read.genalex) we will start from scratch, first with the igs data.

```{r}
data.igs <-read.genalex("IGSGenalex.csv")
```
```{r}
data.igs.f <-as.hierfstat(data.igs)
```
```{r}
str(data.igs.f)
```
And now do a varcomp on it:

```{r}
varcomp.glob(data.igs.f[[1]],data.igs.f[[2]])
```
And now try it for a single population data set:

```{r}
data.test <-read.genalex("Sample5pop.csv")
data.f <-as.hierfstat(data.test)
varcomp.glob(data.f[[1]],data.f[[2]])
```
And it works!  Now on to as.pegas.
